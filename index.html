<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Browser-based drum machine and loop pedal for children ages 8-12">
  <meta name="theme-color" content="#1a1a1a">
  <title>Drum Machine & Loop Pedal</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body data-theme="dark">
  <!-- Tutorial Overlay -->
  <div id="tutorial" class="tutorial hidden" role="dialog" aria-labelledby="tutorial-title" aria-modal="true">
    <div class="tutorial__content">
      <h2 id="tutorial-title" class="tutorial__title">Welcome!</h2>
      <p class="tutorial__text">Let's learn how to make music!</p>
      <div class="tutorial__navigation">
        <button class="btn btn--secondary tutorial__skip" aria-label="Skip tutorial">Skip</button>
        <button class="btn btn--primary tutorial__next" aria-label="Next step">Next</button>
      </div>
    </div>
  </div>

  <!-- Help Overlay -->
  <div id="help" class="help hidden" role="dialog" aria-labelledby="help-title" aria-modal="true">
    <div class="help__content">
      <button class="help__close" aria-label="Close help">√ó</button>
      <h2 id="help-title" class="help__title">Help & Shortcuts</h2>
      <div class="help__sections">
        <section class="help__section">
          <h3>Drum Sequencer</h3>
          <p>Click on the grid to add or remove drum beats. Press play to hear your rhythm!</p>
        </section>
        <section class="help__section">
          <h3>Loop Pedal</h3>
          <p>Record your voice or instruments through the microphone. Layer up to 6 loops!</p>
        </section>
        <section class="help__section">
          <h3>Keyboard Shortcuts</h3>
          <ul>
            <li><kbd>Space</kbd> - Play/Pause</li>
            <li><kbd>Esc</kbd> - Stop</li>
            <li><kbd>+/-</kbd> - Tempo up/down</li>
            <li><kbd>1-9</kbd> - Load presets</li>
            <li><kbd>S</kbd> - Save session</li>
            <li><kbd>H</kbd> - Toggle help</li>
            <li><kbd>T</kbd> - Change theme</li>
          </ul>
        </section>
      </div>
    </div>
  </div>

  <!-- Song Mode Panel -->
  <div id="song-mode-panel" class="help hidden" role="dialog" aria-labelledby="song-mode-title" aria-modal="true">
    <div class="help__content">
      <button class="help__close" aria-label="Close song mode" onclick="document.getElementById('song-mode-panel').classList.add('hidden')">√ó</button>
      <h2 id="song-mode-title" class="help__title">Song Mode</h2>
      <div class="help__sections">
        <section class="help__section">
          <p>Chain patterns together to create complete songs!</p>
          <button id="addSectionBtn" class="btn btn--primary">Add Current Pattern to Song</button>
          <button id="playSongBtn" class="btn btn--secondary">Play Song</button>
          <button id="stopSongBtn" class="btn btn--secondary">Stop Song</button>
          <button id="clearSongBtn" class="btn btn--danger">Clear Song</button>
        </section>
        <section class="help__section">
          <h3>Song Sections</h3>
          <div id="songSections" style="max-height: 300px; overflow-y: auto;">
            <p style="color: var(--color-text-secondary); font-style: italic;">No sections added yet</p>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Visualizations Menu -->
  <div id="viz-menu" class="help hidden" role="dialog" aria-labelledby="viz-menu-title" aria-modal="true">
    <div class="help__content" style="max-width: 400px;">
      <button class="help__close" aria-label="Close visualizations menu" onclick="document.getElementById('viz-menu').classList.add('hidden')">√ó</button>
      <h2 id="viz-menu-title" class="help__title">Visualizations</h2>
      <div class="help__sections">
        <section class="help__section">
          <p>Open visualization windows:</p>
          <button id="openWaveformBtn" class="btn btn--primary" style="width: 100%; margin-bottom: 8px;">Waveform</button>
          <button id="openFrequencyBtn" class="btn btn--primary" style="width: 100%; margin-bottom: 8px;">Frequency Spectrum</button>
          <button id="openOscilloscopeBtn" class="btn btn--primary" style="width: 100%; margin-bottom: 8px;">Oscilloscope</button>
          <button id="openSpectrumBtn" class="btn btn--primary" style="width: 100%; margin-bottom: 8px;">Spectrum Analyzer</button>
          <button id="openMeterBtn" class="btn btn--primary" style="width: 100%; margin-bottom: 8px;">VU Meter</button>
          <button id="closeAllVizBtn" class="btn btn--danger" style="width: 100%; margin-top: 16px;">Close All</button>
        </section>
      </div>
    </div>
  </div>

  <!-- Main Application Container -->
  <div id="app" class="app">
    <!-- Header / Toolbar -->
    <header class="header">
      <div class="header__left">
        <h1 class="header__title">Drum Machine & Loop Pedal</h1>
      </div>
      <div class="header__right">
        <button id="vizBtn" class="btn btn--icon" aria-label="Visualizations" title="Open visualizations">
          <span class="icon">üìä</span>
        </button>
        <button id="effectsBtn" class="btn btn--icon" aria-label="Effects" title="Audio effects">
          <span class="icon">üéöÔ∏è</span>
        </button>
        <button id="songModeBtn" class="btn btn--icon" aria-label="Song mode" title="Song mode">
          <span class="icon">üéµ</span>
        </button>
        <button id="themeBtn" class="btn btn--icon" aria-label="Change theme" title="Change theme">
          <span class="icon">üé®</span>
        </button>
        <button id="helpBtn" class="btn btn--icon" aria-label="Show help" title="Help">
          <span class="icon">?</span>
        </button>
        <button id="saveBtn" class="btn btn--secondary" aria-label="Save session" title="Save your work">
          <span class="icon">üíæ</span> Save
        </button>
        <button id="loadBtn" class="btn btn--secondary" aria-label="Load session" title="Load saved work">
          <span class="icon">üìÅ</span> Load
        </button>
        <button id="exportWavBtn" class="btn btn--primary" aria-label="Export WAV" title="Export audio mix as WAV">
          <span class="icon">üéµ</span> Export WAV
        </button>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="main">
      <!-- Left Panel: Preset Patterns -->
      <aside class="presets" role="complementary" aria-label="Preset patterns">
        <h2 class="presets__title">Presets</h2>
        <div class="presets__list" id="presetList">
          <!-- Preset buttons will be generated by JavaScript -->
        </div>
      </aside>

      <!-- Audio Filters Panel -->
      <aside class="audio-filters" role="complementary" aria-label="Audio effects">
        <h2 class="audio-filters__title">Audio Effects</h2>
        <div class="effects-grid">
          <!-- Reverb -->
          <div class="effect-module">
            <div class="effect-module__header">
              <h3 class="effect-module__title">Reverb</h3>
              <label class="toggle">
                <input type="checkbox" id="reverbEnabled">
                <span class="toggle__slider"></span>
              </label>
            </div>
            <div class="effect-module__controls">
              <label class="control control--compact">
                <span class="control__label">Mix</span>
                <input type="range" id="reverbWetDry" class="control__slider" min="0" max="100" value="30">
                <span class="control__value" id="reverbWetDryValue">30%</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Decay</span>
                <input type="range" id="reverbDecay" class="control__slider" min="1" max="100" value="20">
                <span class="control__value" id="reverbDecayValue">2.0s</span>
              </label>
            </div>
          </div>

          <!-- Delay -->
          <div class="effect-module">
            <div class="effect-module__header">
              <h3 class="effect-module__title">Delay</h3>
              <label class="toggle">
                <input type="checkbox" id="delayEnabled">
                <span class="toggle__slider"></span>
              </label>
            </div>
            <div class="effect-module__controls">
              <label class="control control--compact">
                <span class="control__label">Mix</span>
                <input type="range" id="delayWetDry" class="control__slider" min="0" max="100" value="50">
                <span class="control__value" id="delayWetDryValue">50%</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Time</span>
                <input type="range" id="delayTime" class="control__slider" min="1" max="500" value="37">
                <span class="control__value" id="delayTimeValue">0.375s</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Feedback</span>
                <input type="range" id="delayFeedback" class="control__slider" min="0" max="90" value="40">
                <span class="control__value" id="delayFeedbackValue">40%</span>
              </label>
            </div>
          </div>

          <!-- Distortion -->
          <div class="effect-module">
            <div class="effect-module__header">
              <h3 class="effect-module__title">Distortion</h3>
              <label class="toggle">
                <input type="checkbox" id="distortionEnabled">
                <span class="toggle__slider"></span>
              </label>
            </div>
            <div class="effect-module__controls">
              <label class="control control--compact">
                <span class="control__label">Amount</span>
                <input type="range" id="distortionAmount" class="control__slider" min="0" max="100" value="50">
                <span class="control__value" id="distortionAmountValue">50%</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Tone</span>
                <input type="range" id="distortionTone" class="control__slider" min="0" max="100" value="50">
                <span class="control__value" id="distortionToneValue">50%</span>
              </label>
            </div>
          </div>

          <!-- Compressor -->
          <div class="effect-module">
            <div class="effect-module__header">
              <h3 class="effect-module__title">Compressor</h3>
              <label class="toggle">
                <input type="checkbox" id="compressorEnabled">
                <span class="toggle__slider"></span>
              </label>
            </div>
            <div class="effect-module__controls">
              <label class="control control--compact">
                <span class="control__label">Threshold</span>
                <input type="range" id="compressorThreshold" class="control__slider" min="0" max="100" value="76">
                <span class="control__value" id="compressorThresholdValue">-24dB</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Ratio</span>
                <input type="range" id="compressorRatio" class="control__slider" min="1" max="20" value="4">
                <span class="control__value" id="compressorRatioValue">4:1</span>
              </label>
            </div>
          </div>

          <!-- Filter -->
          <div class="effect-module">
            <div class="effect-module__header">
              <h3 class="effect-module__title">Filter</h3>
              <label class="toggle">
                <input type="checkbox" id="filterEnabled">
                <span class="toggle__slider"></span>
              </label>
            </div>
            <div class="effect-module__controls">
              <label class="control control--compact">
                <span class="control__label">Type</span>
                <select id="filterType" class="control__select">
                  <option value="lowpass">Lowpass</option>
                  <option value="highpass">Highpass</option>
                  <option value="bandpass">Bandpass</option>
                </select>
              </label>
              <label class="control control--compact">
                <span class="control__label">Cutoff</span>
                <input type="range" id="filterFrequency" class="control__slider" min="20" max="20000" value="1000">
                <span class="control__value" id="filterFrequencyValue">1000Hz</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Resonance</span>
                <input type="range" id="filterResonance" class="control__slider" min="0" max="100" value="10">
                <span class="control__value" id="filterResonanceValue">1.0</span>
              </label>
            </div>
          </div>

          <!-- Chorus -->
          <div class="effect-module">
            <div class="effect-module__header">
              <h3 class="effect-module__title">Chorus</h3>
              <label class="toggle">
                <input type="checkbox" id="chorusEnabled">
                <span class="toggle__slider"></span>
              </label>
            </div>
            <div class="effect-module__controls">
              <label class="control control--compact">
                <span class="control__label">Rate</span>
                <input type="range" id="chorusRate" class="control__slider" min="1" max="100" value="15">
                <span class="control__value" id="chorusRateValue">1.5Hz</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Depth</span>
                <input type="range" id="chorusDepth" class="control__slider" min="0" max="100" value="20">
                <span class="control__value" id="chorusDepthValue">20%</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Mix</span>
                <input type="range" id="chorusMix" class="control__slider" min="0" max="100" value="50">
                <span class="control__value" id="chorusMixValue">50%</span>
              </label>
            </div>
          </div>

          <!-- Phaser -->
          <div class="effect-module">
            <div class="effect-module__header">
              <h3 class="effect-module__title">Phaser</h3>
              <label class="toggle">
                <input type="checkbox" id="phaserEnabled">
                <span class="toggle__slider"></span>
              </label>
            </div>
            <div class="effect-module__controls">
              <label class="control control--compact">
                <span class="control__label">Rate</span>
                <input type="range" id="phaserRate" class="control__slider" min="1" max="100" value="5">
                <span class="control__value" id="phaserRateValue">0.5Hz</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Depth</span>
                <input type="range" id="phaserDepth" class="control__slider" min="0" max="100" value="50">
                <span class="control__value" id="phaserDepthValue">50%</span>
              </label>
              <label class="control control--compact">
                <span class="control__label">Feedback</span>
                <input type="range" id="phaserFeedback" class="control__slider" min="0" max="95" value="50">
                <span class="control__value" id="phaserFeedbackValue">50%</span>
              </label>
            </div>
          </div>
        </div>
      </aside>

      <!-- Center Panel: Drum Sequencer -->
      <section class="sequencer" role="region" aria-label="Drum sequencer">
        <div class="sequencer__header">
          <div class="sequencer__title-bar">
            <h2 class="sequencer__title">Drum Sequencer</h2>
            <button id="clearSequencerBtn" class="btn btn--danger btn--small" aria-label="Clear sequencer">
              <span class="icon">‚úï</span> Clear
            </button>
          </div>
          <div class="sequencer__controls">
            <label class="control control--vertical">
              <span class="control__label">BPM</span>
              <input
                type="range"
                id="tempoSlider"
                class="control__slider"
                min="60"
                max="180"
                value="120"
                aria-label="Beats per minute"
              >
              <span class="control__value" id="tempoValue">120</span>
            </label>
          </div>
        </div>

        <!-- Sequencer Grid -->
        <div class="sequencer__grid-container">
          <div class="sequencer__track-names" id="trackNames">
            <!-- Track names will be generated by JavaScript -->
          </div>
          <div class="sequencer__grid-wrapper">
            <canvas
              id="sequencerCanvas"
              class="sequencer__canvas"
              role="img"
              aria-label="16-step drum sequencer grid"
            ></canvas>
          </div>
        </div>

        <!-- Waveform Visualization -->
        <div class="sequencer__visualization">
          <canvas
            id="waveformCanvas"
            class="visualization__canvas"
            aria-label="Audio waveform visualization"
          ></canvas>
        </div>
      </section>

      <!-- Right Panel: Loop Pedal -->
      <aside class="loop-pedal" role="complementary" aria-label="Loop pedal">
        <h2 class="loop-pedal__title">Loop Pedal</h2>

        <!-- Microphone Status -->
        <div class="loop-pedal__mic-status">
          <button id="micBtn" class="btn btn--primary" aria-label="Enable microphone">
            <span class="icon">üé§</span> Enable Mic
          </button>
          <div id="micLevel" class="mic-level hidden">
            <div class="mic-level__bar"></div>
          </div>
        </div>

        <!-- Loop Tracks -->
        <div class="loop-pedal__tracks" id="loopTracks">
          <!-- Loop track controls will be generated by JavaScript -->
        </div>

        <!-- Master Controls -->
        <div class="loop-pedal__master">
          <label class="control control--vertical">
            <span class="control__label">Master Volume</span>
            <input
              type="range"
              id="masterVolume"
              class="control__slider"
              min="0"
              max="100"
              value="80"
              aria-label="Master volume"
            >
            <span class="control__value" id="masterVolumeValue">80%</span>
          </label>
        </div>
      </aside>
    </main>

    <!-- Footer / Transport Controls -->
    <footer class="transport" role="region" aria-label="Transport controls">
      <div class="transport__controls">
        <button id="rewindBtn" class="btn btn--transport" aria-label="Rewind to start" title="Rewind">
          <span class="icon">‚èÆ</span>
        </button>
        <button id="playPauseBtn" class="btn btn--transport btn--play" aria-label="Play" title="Play/Pause (Space)">
          <span class="icon icon--play">‚ñ∂</span>
          <span class="icon icon--pause hidden">‚ùö‚ùö</span>
        </button>
        <button id="stopBtn" class="btn btn--transport" aria-label="Stop" title="Stop (Esc)">
          <span class="icon">‚ñ†</span>
        </button>
        <button id="forwardBtn" class="btn btn--transport" aria-label="Fast forward" title="Fast forward">
          <span class="icon">‚è≠</span>
        </button>
      </div>

      <div class="transport__info">
        <div class="transport__tempo">
          <span class="transport__label">Tempo:</span>
          <span class="transport__value" id="tempoDisplay">120 BPM</span>
        </div>
        <div class="transport__position">
          <span class="transport__label">Beat:</span>
          <span class="transport__value" id="beatDisplay">1.1</span>
        </div>
      </div>
    </footer>
  </div>

  <!-- Tooltip -->
  <div id="tooltip" class="tooltip hidden" role="tooltip"></div>

  <!-- Scripts -->
  <script src="js/wav-encoder.js"></script>
  <script src="js/audio-engine.js"></script>
  <script src="js/presets.js"></script>
  <script src="js/sequencer.js"></script>
  <script src="js/loop-pedal.js"></script>
  <script src="js/effects.js"></script>
  <script src="js/song-mode.js"></script>
  <script src="js/visualizations.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
